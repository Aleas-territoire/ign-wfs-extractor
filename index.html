<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extraction WFS BD TOPO IGN - Par Commune</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1>üó∫Ô∏è Extracteur BD TOPO IGN</h1>
            <p class="subtitle">Extraction de donn√©es g√©ographiques par commune</p>
        </div>
        <button id="help-toggle" class="help-btn">
            <span>‚ùì</span> Aide
        </button>
    </header>

    <!-- Panneau d'aide escamotable -->
    <div id="help-panel" class="help-panel">
        <div class="help-content">
            <button id="help-close" class="help-close">‚úï</button>
            <h2>üí° Guide d'utilisation</h2>
            
            <div class="help-steps">
                <div class="help-step">
                    <span class="help-step-number">1</span>
                    <div class="help-step-content">
                        <h3>Rechercher une commune</h3>
                        <p>Utilisez la barre de recherche pour trouver votre commune. L'autocompl√©tion vous aidera.</p>
                    </div>
                </div>
                
                <div class="help-step">
                    <span class="help-step-number">2</span>
                    <div class="help-step-content">
                        <h3>S√©lectionner une couche</h3>
                        <p>Choisissez le type de donn√©es : b√¢timents, routes, hydrographie, v√©g√©tation, etc.</p>
                    </div>
                </div>
                
                <div class="help-step">
                    <span class="help-step-number">3</span>
                    <div class="help-step-content">
                        <h3>Configurer l'extraction</h3>
                        <p>D√©finissez le nombre maximum d'entit√©s et activez le filtrage spatial si n√©cessaire.</p>
                    </div>
                </div>
                
                <div class="help-step">
                    <span class="help-step-number">4</span>
                    <div class="help-step-content">
                        <h3>Lancer l'extraction</h3>
                        <p>Cliquez sur "Extraire" et visualisez les r√©sultats sur la carte.</p>
                    </div>
                </div>
                
                <div class="help-step">
                    <span class="help-step-number">5</span>
                    <div class="help-step-content">
                        <h3>Exporter les donn√©es</h3>
                        <p>T√©l√©chargez vos donn√©es au format GeoJSON pour les utiliser dans votre SIG.</p>
                    </div>
                </div>
            </div>
            
            <div class="help-info">
                <h3>‚ÑπÔ∏è Informations techniques</h3>
                <ul>
                    <li><strong>Filtrage spatial pr√©cis</strong> : Utilise Turf.js pour ne conserver que les entit√©s dans la commune</li>
                    <li><strong>Subdivision spatiale</strong> : Contourne les limites serveur pour extraire toutes les donn√©es</li>
                    <li><strong>Sources</strong> : BD TOPO v3 de l'IGN via service WFS</li>
                </ul>
            </div>
        </div>
    </div>

    <main>
        <div class="container">
            <!-- Panneau de contr√¥le -->
            <aside class="control-panel">
                <div class="control-panel-scroll">
                    <!-- Recherche de commune -->
                    <div class="card card-primary">
                        <div class="card-header">
                            <h2>üìç Commune</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <input 
                                    type="text" 
                                    id="commune-search" 
                                    placeholder="Rechercher une commune..."
                                    autocomplete="off"
                                >
                                <div id="suggestions" class="suggestions"></div>
                            </div>
                            <div id="commune-info" class="commune-info">
                                <small>Aucune commune s√©lectionn√©e</small>
                            </div>
                        </div>
                    </div>

                    <!-- S√©lection de la couche -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üóÇÔ∏è Couche de donn√©es</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <select id="layer-select">
                                    <optgroup label="üèóÔ∏è B√¢ti">
                                        <option value="BDTOPO_V3:batiment">B√¢timents</option>
                                        <option value="BDTOPO_V3:construction_lineaire">Constructions lin√©aires</option>
                                        <option value="BDTOPO_V3:construction_ponctuelle">Constructions ponctuelles</option>
                                    </optgroup>
                                    
                                    <optgroup label="üõ£Ô∏è Transport">
                                        <option value="BDTOPO_V3:troncon_de_route">Tron√ßons de route</option>
                                        <option value="BDTOPO_V3:route_numerotee_ou_nommee">Routes num√©rot√©es</option>
                                        <option value="BDTOPO_V3:troncon_de_voie_ferree">Voies ferr√©es</option>
                                        <option value="BDTOPO_V3:aire_de_triage">Aires de triage</option>
                                        <option value="BDTOPO_V3:equipement_de_transport">√âquipements de transport</option>
                                    </optgroup>
                                    
                                    <optgroup label="üíß Hydrographie">
                                        <option value="BDTOPO_V3:troncon_hydrographique">Cours d'eau</option>
                                        <option value="BDTOPO_V3:plan_d_eau">Plans d'eau</option>
                                        <option value="BDTOPO_V3:reservoir">R√©servoirs</option>
                                        <option value="BDTOPO_V3:surface_hydrographique">Surfaces hydrographiques</option>
                                        <option value="BDTOPO_V3:cours_d_eau">Entit√©s cours d'eau</option>
                                    </optgroup>
                                    
                                    <optgroup label="üå≥ V√©g√©tation">
                                        <option value="BDTOPO_V3:zone_de_vegetation">Zones de v√©g√©tation</option>
                                        <option value="BDTOPO_V3:haie">Haies</option>
                                    </optgroup>
                                    
                                    <optgroup label="‚ö° R√©seaux">
                                        <option value="BDTOPO_V3:ligne_electrique">Lignes √©lectriques</option>
                                        <option value="BDTOPO_V3:poste_de_transformation">Postes de transformation</option>
                                        <option value="BDTOPO_V3:pylone">Pyl√¥nes</option>
                                        <option value="BDTOPO_V3:conduite">Conduites</option>
                                    </optgroup>
                                    
                                    <optgroup label="üèÉ Sport">
                                        <option value="BDTOPO_V3:terrain_de_sport">Terrains de sport</option>
                                        <option value="BDTOPO_V3:piste_d_aerodrome">Pistes d'a√©rodrome</option>
                                    </optgroup>
                                    
                                    <optgroup label="üèõÔ∏è Administratif">
                                        <option value="BDTOPO_V3:commune">Limites communales</option>
                                        <option value="BDTOPO_V3:arrondissement">Arrondissements</option>
                                        <option value="BDTOPO_V3:epci">EPCI</option>
                                    </optgroup>
                                    
                                    <optgroup label="‚ö∞Ô∏è Autres">
                                        <option value="BDTOPO_V3:cimetiere">Cimeti√®res</option>
                                        <option value="BDTOPO_V3:zone_d_activite_ou_d_interet">Zones d'activit√©</option>
                                        <option value="BDTOPO_V3:point_du_reseau">Points du r√©seau</option>
                                        <option value="BDTOPO_V3:lieu_dit_non_habite">Lieux-dits</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Param√®tres d'extraction -->
                    <div class="card">
                        <div class="card-header">
                            <h2>‚öôÔ∏è Param√®tres</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="feature-limit">Limite d'entit√©s</label>
                                <select id="feature-limit">
                                    <option value="1000">1 000</option>
                                    <option value="5000">5 000</option>
                                    <option value="10000" selected>10 000</option>
                                    <option value="25000">25 000</option>
                                    <option value="50000">50 000</option>
                                    <option value="unlimited">Illimit√© ‚ö†Ô∏è</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="spatial-filter" checked>
                                    <span>Filtrage spatial pr√©cis</span>
                                </label>
                                <small class="help-text">Conserve uniquement les entit√©s dans les limites de la commune</small>
                            </div>

                            <button id="extract-btn" class="btn-primary">
                                <span class="btn-icon">üîç</span>
                                <span>Extraire les donn√©es</span>
                            </button>

                            <div id="status" class="status"></div>
                        </div>
                    </div>

                    <!-- R√©sultats -->
                    <div class="card card-results">
                        <div class="card-header">
                            <h2>üìä R√©sultats</h2>
                        </div>
                        <div class="card-body">
                            <div id="results-info" class="results-info">
                                <small style="color: #999;">Aucune extraction effectu√©e</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bouton export sticky en bas -->
                <div class="export-sticky">
                    <button id="export-geojson" class="btn-secondary" disabled>
                        <span class="btn-icon">üì•</span>
                        <span>T√©l√©charger GeoJSON</span>
                    </button>
                </div>
            </aside>

            <!-- Carte -->
            <section class="map-section">
                <div class="map-container">
                    <div id="map"></div>
                    <div class="map-legend">
                        <h4>L√©gende</h4>
                        <div id="legend-content">
                            <div class="legend-item">
                                <span class="legend-color" style="background: #3388ff;"></span>
                                <span>Commune</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <p>
                <strong>Donn√©es</strong> : ¬© <a href="https://www.ign.fr" target="_blank">IGN</a> - BD TOPO¬Æ |
                <strong>Technologies</strong> : <a href="https://leafletjs.com" target="_blank">Leaflet</a>, <a href="https://turfjs.org" target="_blank">Turf.js</a>
                <strong>R√©alisation</strong> : - Josselin Thonnelier -
            </p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>
    <script src="app.js"></script>
</body>
</html>


