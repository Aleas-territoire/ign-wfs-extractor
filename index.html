<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extraction WFS BD TOPO IGN - Par Commune</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>üó∫Ô∏è Extraction WFS BD TOPO IGN</h1>
        <p class="subtitle">Interrogez la base de donn√©es g√©ographiques de l'IGN par commune</p>
    </header>

    <main>
        <div class="container">
            <!-- Panneau de contr√¥le -->
            <aside class="control-panel">
                <div class="card">
                    <h2>üìç S√©lection de la commune</h2>
                    
                    <div class="form-group">
                        <label for="commune-search">Rechercher une commune :</label>
                        <input 
                            type="text" 
                            id="commune-search" 
                            placeholder="Ex: Paris, Lyon, Niort..."
                            autocomplete="off"
                        >
                        <div id="suggestions" class="suggestions"></div>
                    </div>

                    <div class="form-group">
                        <label for="layer-select">Couche BD TOPO :</label>
                        <select id="layer-select">
                            <optgroup label="üèóÔ∏è B√¢ti">
                                <option value="BDTOPO_V3:batiment">B√¢timents</option>
                                <option value="BDTOPO_V3:construction_lineaire">Constructions lin√©aires (murs, cl√¥tures)</option>
                                <option value="BDTOPO_V3:construction_ponctuelle">Constructions ponctuelles</option>
                            </optgroup>
                            
                            <optgroup label="üõ£Ô∏è Transport">
                                <option value="BDTOPO_V3:troncon_de_route">Tron√ßons de route</option>
                                <option value="BDTOPO_V3:route_numerotee_ou_nommee">Routes num√©rot√©es</option>
                                <option value="BDTOPO_V3:troncon_de_voie_ferree">Voies ferr√©es</option>
                                <option value="BDTOPO_V3:aire_de_triage">Aires de triage</option>
                                <option value="BDTOPO_V3:equipement_de_transport">√âquipements de transport</option>
                            </optgroup>
                            
                            <optgroup label="üíß Hydrographie">
                                <option value="BDTOPO_V3:troncon_hydrographique">Cours d'eau</option>
                                <option value="BDTOPO_V3:plan_d_eau">Plans d'eau</option>
                                <option value="BDTOPO_V3:reservoir">R√©servoirs</option>
                                <option value="BDTOPO_V3:surface_hydrographique">Surfaces hydrographiques</option>
                                <option value="BDTOPO_V3:cours_d_eau">Entit√©s cours d'eau</option>
                            </optgroup>
                            
                            <optgroup label="üå≥ V√©g√©tation et zones naturelles">
                                <option value="BDTOPO_V3:zone_de_vegetation">Zones de v√©g√©tation</option>
                                <option value="BDTOPO_V3:haie">Haies</option>
                            </optgroup>
                            
                            <optgroup label="‚ö° R√©seaux et √©nergie">
                                <option value="BDTOPO_V3:ligne_electrique">Lignes √©lectriques</option>
                                <option value="BDTOPO_V3:poste_de_transformation">Postes de transformation</option>
                                <option value="BDTOPO_V3:pylone">Pyl√¥nes</option>
                                <option value="BDTOPO_V3:conduite">Conduites</option>
                            </optgroup>
                            
                            <optgroup label="üèÉ Sport et loisirs">
                                <option value="BDTOPO_V3:terrain_de_sport">Terrains de sport</option>
                                <option value="BDTOPO_V3:piste_d_aerodrome">Pistes d'a√©rodrome</option>
                            </optgroup>
                            
                            <optgroup label="‚ö∞Ô∏è Cimeti√®res">
                                <option value="BDTOPO_V3:cimetiere">Cimeti√®res</option>
                            </optgroup>
                            
                            <optgroup label="üèõÔ∏è Administratif">
                                <option value="BDTOPO_V3:commune">Limites communales</option>
                                <option value="BDTOPO_V3:arrondissement">Arrondissements</option>
                                <option value="BDTOPO_V3:epci">EPCI</option>
                            </optgroup>
                            
                            <optgroup label="üè≠ Activit√©s √©conomiques">
                                <option value="BDTOPO_V3:zone_d_activite_ou_d_interet">Zones d'activit√©</option>
                            </optgroup>
                            
                            <optgroup label="üèûÔ∏è Divers">
                                <option value="BDTOPO_V3:point_du_reseau">Points du r√©seau</option>
                                <option value="BDTOPO_V3:lieu_dit_non_habite">Lieux-dits non habit√©s</option>
                                <option value="BDTOPO_V3:toponymie_lieux_nommes">Toponymie</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="feature-limit">Nombre maximum d'entit√©s :</label>
                        <select id="feature-limit">
                            <option value="1000">1 000 entit√©s</option>
                            <option value="5000">5 000 entit√©s</option>
                            <option value="10000">10 000 entit√©s</option>
                            <option value="25000">25 000 entit√©s</option>
                            <option value="50000" selected>50 000 entit√©s</option>
                            <option value="unlimited">Illimit√© (prudence !)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="spatial-filter" checked>
                            Filtrage spatial pr√©cis (utilise les limites communales)
                        </label>
                    </div>

                    <button id="extract-btn" class="btn-primary">
                        üîç Extraire les donn√©es
                    </button>

                    <div id="status" class="status"></div>
                </div>

                <div class="card info-panel">
                    <h3>‚ÑπÔ∏è Informations</h3>
                    <div id="info-content">
                        <p>S√©lectionnez une commune et une couche pour commencer l'extraction.</p>
                    </div>
                </div>

                <div class="card">
                    <h3>üíæ Export des donn√©es</h3>
                    <button id="export-geojson" class="btn-secondary" disabled>
                        üì• T√©l√©charger GeoJSON
                    </button>
                </div>
            </aside>

            <!-- Carte -->
            <section class="map-container">
                <div id="map"></div>
                <div class="map-legend">
                    <h4>L√©gende</h4>
                    <div id="legend-content">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #3388ff;"></span>
                            <span>Commune s√©lectionn√©e</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Section didactique -->
        <section class="tutorial">
            <div class="container-full">
                <h2>üìö Comment utiliser cet outil ?</h2>
                
                <div class="tutorial-grid">
                    <div class="tutorial-card">
                        <div class="step-number">1</div>
                        <h3>Rechercher une commune</h3>
                        <p>Tapez le nom d'une commune fran√ßaise dans le champ de recherche. Des suggestions appara√Ætront automatiquement.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">2</div>
                        <h3>Choisir une th√©matique</h3>
                        <p>S√©lectionnez une couche parmi les th√©matiques organis√©es : b√¢ti, transport, hydrographie, v√©g√©tation, r√©seaux, sport, etc.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">3</div>
                        <h3>D√©finir la limite</h3>
                        <p>Choisissez le nombre maximum d'entit√©s √† extraire. Pour les grandes villes, commencez avec 5 000 puis augmentez si n√©cessaire.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">4</div>
                        <h3>Filtrage spatial</h3>
                        <p>Le filtrage spatial pr√©cis garantit que seules les entit√©s r√©ellement dans la commune sont extraites gr√¢ce √† la subdivision spatiale.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">5</div>
                        <h3>Extraire les donn√©es</h3>
                        <p>Cliquez sur "Extraire les donn√©es". L'outil subdivise automatiquement la zone pour contourner les limites serveur.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">6</div>
                        <h3>Explorer et exporter</h3>
                        <p>Cliquez sur les entit√©s pour voir leurs propri√©t√©s. T√©l√©chargez les donn√©es au format GeoJSON pour votre SIG.</p>
                    </div>
                </div>

                <div class="tech-info">
                    <h3>üîß Technologies utilis√©es</h3>
                    <ul>
                        <li><strong>API D√©coupage Administratif</strong> : Recherche de communes fran√ßaises</li>
                        <li><strong>WFS BD TOPO v3 (IGN)</strong> : Service web de donn√©es g√©ographiques</li>
                        <li><strong>Leaflet</strong> : Biblioth√®que de cartographie interactive</li>
                        <li><strong>Turf.js</strong> : Analyse spatiale et filtrage g√©om√©trique pr√©cis</li>
                        <li><strong>GeoJSON</strong> : Format d'√©change de donn√©es g√©ographiques</li>
                    </ul>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: #d4edda; border-left: 4px solid #28a745; border-radius: 4px;">
                        <strong>‚ú® Extraction optimis√©e !</strong><br>
                        Le syst√®me utilise une subdivision spatiale automatique pour extraire toutes les donn√©es, 
                        m√™me pour les grandes communes avec des dizaines de milliers d'entit√©s.
                    </div>

                    <div style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
                        <strong>‚ö†Ô∏è Conseil d'utilisation :</strong><br>
                        Les extractions importantes peuvent prendre quelques minutes. 
                        Le statut vous indique la progression zone par zone.
                    </div>

                    <div style="margin-top: 1rem; padding: 1rem; background: #d1ecf1; border-left: 4px solid #0c5460; border-radius: 4px;">
                        <strong>üí° Organisation th√©matique :</strong><br>
                        Les couches sont organis√©es par th√©matiques : B√¢ti, Transport, Hydrographie, V√©g√©tation, 
                        R√©seaux, Sport, Cimeti√®res, Administratif, Activit√©s √©conomiques. Choisissez celle qui correspond √† votre besoin.
                    </div>
                </div>

                <div style="margin-top: 2rem; padding: 2rem; background: white; border-radius: 8px; border: 2px solid #e9ecef;">
                    <h3 style="color: #008B8B; margin-bottom: 1rem;">üìã Th√©matiques disponibles</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
                        <div class="theme-card">
                            <h4>üèóÔ∏è B√¢ti</h4>
                            <ul>
                                <li>B√¢timents</li>
                                <li>Constructions lin√©aires</li>
                                <li>Constructions ponctuelles</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>üõ£Ô∏è Transport</h4>
                            <ul>
                                <li>Tron√ßons de route</li>
                                <li>Routes num√©rot√©es</li>
                                <li>Voies ferr√©es</li>
                                <li>Aires de triage</li>
                                <li>√âquipements de transport</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>üíß Hydrographie</h4>
                            <ul>
                                <li>Cours d'eau</li>
                                <li>Plans d'eau</li>
                                <li>R√©servoirs</li>
                                <li>Surfaces hydrographiques</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>üå≥ V√©g√©tation</h4>
                            <ul>
                                <li>Zones de v√©g√©tation</li>
                                <li>Haies</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>‚ö° R√©seaux</h4>
                            <ul>
                                <li>Lignes √©lectriques</li>
                                <li>Postes de transformation</li>
                                <li>Pyl√¥nes</li>
                                <li>Conduites</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>üèÉ Sport & Loisirs</h4>
                            <ul>
                                <li>Terrains de sport</li>
                                <li>Pistes d'a√©rodrome</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>‚ö∞Ô∏è Cimeti√®res</h4>
                            <ul>
                                <li>Cimeti√®res</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>üèõÔ∏è Administratif</h4>
                            <ul>
                                <li>Limites communales</li>
                                <li>Arrondissements</li>
                                <li>EPCI</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>üè≠ Activit√©s</h4>
                            <ul>
                                <li>Zones d'activit√©</li>
                            </ul>
                        </div>
                        
                        <div class="theme-card">
                            <h4>üèûÔ∏è Divers</h4>
                            <ul>
                                <li>Points du r√©seau</li>
                                <li>Lieux-dits</li>
                                <li>Toponymie</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>Donn√©es ¬© <a href="https://www.ign.fr" target="_blank">IGN</a> - BD TOPO¬Æ | 
           R√©alis√© avec <a href="https://leafletjs.com" target="_blank">Leaflet</a> et <a href="https://turfjs.org" target="_blank">Turf.js</a> | 
           <a href="https://github.com" target="_blank">Code source sur GitHub</a></p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
