<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extraction WFS BD TOPO IGN - Par Commune</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>üó∫Ô∏è Extraction WFS BD TOPO IGN</h1>
        <p class="subtitle">Interrogez la base de donn√©es g√©ographiques de l'IGN par commune</p>
    </header>

    <main>
        <div class="container">
            <!-- Panneau de contr√¥le -->
            <aside class="control-panel">
                <div class="card">
                    <h2>üìç S√©lection de la commune</h2>
                    
                    <div class="form-group">
                        <label for="commune-search">Rechercher une commune :</label>
                        <input 
                            type="text" 
                            id="commune-search" 
                            placeholder="Ex: Paris, Lyon, Niort..."
                            autocomplete="off"
                        >
                        <div id="suggestions" class="suggestions"></div>
                    </div>

                    <div class="form-group">
                        <label for="layer-select">Couche BD TOPO :</label>
                        <select id="layer-select">
                            <option value="BDTOPO_V3:batiment">B√¢timents</option>
                            <option value="BDTOPO_V3:commune">Limites communales</option>
                            <option value="BDTOPO_V3:troncon_de_route">Tron√ßons de route</option>
                            <option value="BDTOPO_V3:troncon_hydrographique">Cours d'eau</option>
                            <option value="BDTOPO_V3:plan_d_eau">Plans d'eau</option>
                            <option value="BDTOPO_V3:zone_de_vegetation">Zones de v√©g√©tation</option>
                            <option value="BDTOPO_V3:ligne_electrique">Lignes √©lectriques</option>
                            <option value="BDTOPO_V3:construction_lineaire">Constructions lin√©aires</option>
                            <option value="BDTOPO_V3:reservoir">R√©servoirs</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="feature-limit">Nombre maximum d'entit√©s :</label>
                        <select id="feature-limit">
                            <option value="1000">1 000 entit√©s</option>
                            <option value="5000">5 000 entit√©s</option>
                            <option value="10000">10 000 entit√©s</option>
                            <option value="25000">25 000 entit√©s</option>
                            <option value="50000" selected>50 000 entit√©s</option>
                            <option value="unlimited">Illimit√© (prudence !)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="spatial-filter" checked>
                            Filtrage spatial pr√©cis (utilise les limites communales)
                        </label>
                    </div>

                    <button id="extract-btn" class="btn-primary">
                        üîç Extraire les donn√©es
                    </button>

                    <div id="status" class="status"></div>
                </div>

                <div class="card info-panel">
                    <h3>‚ÑπÔ∏è Informations</h3>
                    <div id="info-content">
                        <p>S√©lectionnez une commune et une couche pour commencer l'extraction.</p>
                    </div>
                </div>

                <div class="card">
                    <h3>üíæ Export des donn√©es</h3>
                    <button id="export-geojson" class="btn-secondary" disabled>
                        üì• T√©l√©charger GeoJSON
                    </button>
                </div>
            </aside>

            <!-- Carte -->
            <section class="map-container">
                <div id="map"></div>
                <div class="map-legend">
                    <h4>L√©gende</h4>
                    <div id="legend-content">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #3388ff;"></span>
                            <span>Commune s√©lectionn√©e</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Section didactique -->
        <section class="tutorial">
            <div class="container-full">
                <h2>üìö Comment utiliser cet outil ?</h2>
                
                <div class="tutorial-grid">
                    <div class="tutorial-card">
                        <div class="step-number">1</div>
                        <h3>Rechercher une commune</h3>
                        <p>Tapez le nom d'une commune fran√ßaise dans le champ de recherche. Des suggestions appara√Ætront automatiquement.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">2</div>
                        <h3>Choisir une couche</h3>
                        <p>S√©lectionnez le type de donn√©es g√©ographiques que vous souhaitez extraire : b√¢timents, routes, cours d'eau, etc.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">3</div>
                        <h3>D√©finir la limite</h3>
                        <p>Choisissez le nombre maximum d'entit√©s √† extraire. Pour les grandes villes, commencez avec 5 000 puis augmentez si n√©cessaire.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">4</div>
                        <h3>Filtrage spatial</h3>
                        <p>Le filtrage spatial pr√©cis garantit que seules les entit√©s r√©ellement dans la commune sont extraites (pas seulement dans l'emprise).</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">5</div>
                        <h3>Extraire les donn√©es</h3>
                        <p>Cliquez sur "Extraire les donn√©es" pour interroger le service WFS de l'IGN et visualiser les r√©sultats sur la carte.</p>
                    </div>

                    <div class="tutorial-card">
                        <div class="step-number">6</div>
                        <h3>Explorer et exporter</h3>
                        <p>Cliquez sur les entit√©s pour voir leurs propri√©t√©s. T√©l√©chargez les donn√©es au format GeoJSON pour votre SIG.</p>
                    </div>
                </div>

                <div class="tech-info">
                    <h3>üîß Technologies utilis√©es</h3>
                    <ul>
                        <li><strong>API D√©coupage Administratif</strong> : Recherche de communes fran√ßaises</li>
                        <li><strong>WFS BD TOPO v3 (IGN)</strong> : Service web de donn√©es g√©ographiques</li>
                        <li><strong>Leaflet</strong> : Biblioth√®que de cartographie interactive</li>
                        <li><strong>Turf.js</strong> : Analyse spatiale et filtrage g√©om√©trique pr√©cis</li>
                        <li><strong>GeoJSON</strong> : Format d'√©change de donn√©es g√©ographiques</li>
                    </ul>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: #d4edda; border-left: 4px solid #28a745; border-radius: 4px;">
                        <strong>‚ú® Filtrage spatial am√©lior√© !</strong><br>
                        Le filtrage spatial pr√©cis utilise les limites communales exactes pour ne s√©lectionner que les entit√©s r√©ellement dans la commune. 
                        Cela √©limine les donn√©es en p√©riph√©rie qui seraient dans l'emprise rectangulaire mais hors de la commune.
                    </div>

                    <div style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
                        <strong>‚ö†Ô∏è Conseil d'utilisation :</strong><br>
                        Le filtrage spatial peut prendre quelques secondes suppl√©mentaires pour les grandes extractions. 
                        Vous pouvez le d√©sactiver pour gagner du temps si vous n'avez pas besoin d'une pr√©cision maximale.
                    </div>

                    <div style="margin-top: 1rem; padding: 1rem; background: #d1ecf1; border-left: 4px solid #0c5460; border-radius: 4px;">
                        <strong>üí° Astuce :</strong><br>
                        Si vous atteignez la limite d'entit√©s, le syst√®me vous l'indiquera. Vous pourrez alors augmenter 
                        cette limite ou affiner votre zone de recherche.
                    </div>
                </div>

                <div style="margin-top: 2rem; padding: 2rem; background: white; border-radius: 8px; border: 2px solid #e9ecef;">
                    <h3 style="color: #008B8B; margin-bottom: 1rem;">üìã Couches disponibles</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>üè¢ B√¢timents</strong><br>
                            <small>Tous les b√¢timents construits</small>
                        </div>
                        <div>
                            <strong>üèõÔ∏è Limites communales</strong><br>
                            <small>Contours administratifs</small>
                        </div>
                        <div>
                            <strong>üõ£Ô∏è Tron√ßons de route</strong><br>
                            <small>R√©seau routier d√©taill√©</small>
                        </div>
                        <div>
                            <strong>üíß Cours d'eau</strong><br>
                            <small>R√©seau hydrographique lin√©aire</small>
                        </div>
                        <div>
                            <strong>üåä Plans d'eau</strong><br>
                            <small>Lacs, √©tangs, mares</small>
                        </div>
                        <div>
                            <strong>üå≥ V√©g√©tation</strong><br>
                            <small>For√™ts, parcs, espaces verts</small>
                        </div>
                        <div>
                            <strong>‚ö° Lignes √©lectriques</strong><br>
                            <small>R√©seau √©lectrique a√©rien</small>
                        </div>
                        <div>
                            <strong>üèóÔ∏è Constructions lin√©aires</strong><br>
                            <small>Murs, cl√¥tures, digues</small>
                        </div>
                        <div>
                            <strong>üè≠ R√©servoirs</strong><br>
                            <small>Ch√¢teaux d'eau, cuves</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>Donn√©es ¬© <a href="https://www.ign.fr" target="_blank">IGN</a> - BD TOPO¬Æ | 
           R√©alis√© avec <a href="https://leafletjs.com" target="_blank">Leaflet</a> et <a href="https://turfjs.org" target="_blank">Turf.js</a> | 
           <a href="https://github.com" target="_blank">Code source sur GitHub</a></p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
